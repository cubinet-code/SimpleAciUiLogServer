{"name":"SimpleAciUiLogServer","tagline":"A Simple HTTP server that acts as an APIC UI remote API Inspector.","body":"====================\r\nSimpleAciUiLogServer\r\n====================\r\n\r\nA Simple HTTP/HTTPS server that accepts POSTs from the APIC UI as a remote API\r\nInspector.\r\n\r\nThe simplest method to use this module is to execute it as a standalone script,\r\nhowever it is designed to allow it to be imported as a module as well.\r\n\r\nStandalone Script\r\n-----------------\r\n\r\n.. code-block:: bash\r\n\r\n    $ SimpleAci\r\n    SimpleAciUiLogServer     SimpleAciUiLogServer.py\r\n    $ SimpleAciUiLogServer\r\n    serving at:\r\n    http://10.10.10.107:8987/apiinspector\r\n    https://10.10.10.107:8443/apiinspector\r\n\r\n    2015-01-25 05:07:11,040 DEBUG - \r\n\r\n        method: GET\r\n           url: http://172.1.1.176/api/node/class/fabricTopology.json?subscription=yes\r\n       payload: None\r\n        # objs: 1\r\n      response: {\"totalCount\":\"1\",\"subscriptionId\":\"72057761559216131\",\"imdata\":\r\n      [{\"fabricTopology\":{\"attributes\":{\"childAction\":\"\",\"dn\":\"topology\",\r\n      \"lcOwn\":\"local\",\"modTs\":\"2015-01-08T02:10:36.147+04:00\",\"monPolDn\":\r\n      \"uni/fabric/monfab-default\",\"status\":\"\"}}}]}\r\n\r\nThe standalone script can be invoked using any of these commands:\r\n\r\n* SimpleAciUiLogServer\r\n* SimpleAciUiLogServer.py\r\n* acilogserv\r\n\r\nThe standalone script also allows you to set several options:\r\n\r\n* -a or --apicip: The IP address of an APIC or an IP address on the same subnet\r\n  as the APIC.  This allows the standalone server to be able to print the\r\n  correct IP address when it announces what IP address, port and location\r\n  it is listening on if the server is multi-homed.\r\n* -p or --port: The http port the server should listen on.\r\n* -s or --sslport: The https port the server should listen on.\r\n* -c or --cert: The server certificate for HTTPS connections.\r\n* -l or --location: The local path that the server should look for, anything\r\n  sent to the server outside of this location will result in the server\r\n  returning a 404.  The default is /apiinspector\r\n* -r or --logrequests: This will cause the server to log a message about the\r\n  POST request to sys.stderr, the default is False, possible values are True\r\n  and False.\r\n* -d or --delete-imdata: Strip out the im_data and other info at the im_data\r\n  level from the payloads and responses.\r\n* -n or --nice-output: Pretty print the payloads and responses.\r\n* -i or --indent: Number of spaces to indent when pretty printing.\r\n\r\nWhen the module is run as a standalone script it simply logs the messages\r\nto sys.stdout using the standard logging module.\r\n\r\nImporting as a module\r\n---------------------\r\n\r\nYou can also import the module and use it as a server as part of another\r\napplication.  This provides you with flexibility as it allows the registration\r\nof callback functions for each HTTP method (GET, POST, DELETE, etc) found in the\r\nlog message.  From this, it is possible to do things like use the data from the\r\nlog message for other purposes or filter out specific logs messages based on\r\nthe HTTP method.  The methods that the APIC uses are:\r\n\r\n* GET\r\n* POST\r\n* EventChannelMessage\r\n* undefined - NOTE: This is an APIC bug that is fixed in versions after 1.0(2*)\r\n\r\nExample:\r\n\r\n.. code-block:: python\r\n\r\n    >>> from SimpleAciUiLogServer.SimpleAciUiLogServer import \\\r\n    ... SimpleAciUiLogServer\r\n    >>> import logging\r\n    >>> \r\n    >>> logging.basicConfig(level=logging.DEBUG)\r\n    >>> def GET(**kwargs):\r\n    ...     logging.debug(\"Got a GET\")\r\n    ... \r\n    >>> def POST(**kwargs):\r\n    ...     logging.debug(\"Kwargs/params: {0}\".format(kwargs))\r\n    ... \r\n    >>> server = SimpleAciUiLogServer((\"\", 8987), location='/apiinspector')\r\n    >>> server.register_function(GET)\r\n    >>> server.register_function(POST)\r\n    >>> server.serve_forever()\r\n    DEBUG:root:Got a GET\r\n    DEBUG:root:\r\n        method: Event Channel Message\r\n           url: N/A\r\n       payload: N/A\r\n        # objs: 0\r\n      response: {\"subscriptionId\":[\"72057611234639895\",\"72057611234640073\"],\r\n      \"imdata\":[{\"fvTenant\":{\"attributes\":{\"childAction\":\"\",\"dn\":\r\n      \"uni/tn-mtimm-simple\",\"modTs\":\"2015-01-23T23:04:28.838+00:00\",\"rn\":\"\",\r\n      \"status\":\"deleted\"}}}]}\r\n    \r\n    DEBUG:root:Kwargs/params: {'data': {'url':\r\n    'http://172.1.1.5/api/node/mo/uni.json', 'response': '{\"imdata\":[]}', \r\n    'preamble': '18:00:12 DEBUG - ', 'method': 'POST', 'payload': '{\"polUni\":{\r\n    \"attributes\":{\"dn\":\"uni\",\"status\":\"modified\"},\"children\":[{\"fvTenant\":{\r\n    \"attributes\":{\"dn\":\"uni/tn-mtimm-simple\",\"status\":\"deleted\"},\"children\":[]}\r\n    }]}}'}, 'layout': 'PatternLayout'}\r\n\r\nNote: since there were no functions registered for the EventChannelMessage\r\nmethod, SimpleAciUiLogServer sent that data to the default dispatch method\r\nwhich logs a formatted message. However, both GET and POST have registered\r\nfunctions and they do different things than the default dispatch method.\r\n\r\nIt is also possible to override the \\_dispatch method to create your own\r\ndispatch logic, for example rather than dispatch based on method maybe you\r\nwould like to dispatch based on subscription id.\r\n\r\nMulti-threaded Servers\r\n----------------------\r\n\r\nThe SimpleAciUiLogServer class is single threaded.  If many APIC's are going\r\nto be reporting into the same server, one transaction may block another until\r\nthe first is complete.  This scenario can be avoided using the\r\nThreadingSimpleAciUiLogServer class.  The ThreadingSimpleAciUiLogServer class\r\nprovides a threaded server that can accept multiple connections at the same\r\ntime.  When using the ThreadingSimpleAciUiLogServer it is best to use the\r\nlogging functionality from the Python standard library rather than print\r\nstatements because the logging module is thread safe.\r\n\r\nIf you need to listen on multiple ports you will need to instantiate multiple,\r\nSimpleAciUiLogServer or ThreadingSimpleAciUiLogServers.  This might be done\r\nto start up both a http and https server. The module provides its own\r\nserve_forever() method that dispatches to multiple server instances.  Otherwise\r\nthe servers own serve_forever() method is appropriate.  The standalone script\r\noffers an example of doing this.\r\n\r\nHTTPS TLS/SSL Support\r\n---------------------\r\n\r\nTo accept HTTPS connections the SimpleAciUiLogServer or the\r\nThreadingSimpleAciUiLogServer classes can be instantiated with the cert\r\nparameter pointed at a file that contains the servers certificate.  The module\r\ncomes with an embedded self-signed certificate but use of this should be avoided\r\nin long-term production scenarios.  A self-signed certificate can be created\r\nusing openssl:\r\n\r\n.. code-block:: bash\r\n\r\n    openssl req -new -x509 -keyout server.pem -out server.pem -days 36500 -nodes\r\n\r\nWhen the cert parameter is passed to the class initializer and is not None, the\r\nsocket is wrapped in ssl allowing the APIC to send https POST's to the server.\r\n\r\nIf you are using self-signed certificates, you will most likely need to accept\r\nthe certificate as a security exception in your browser before the APIC can send\r\ndata to it.  This is usually a one-time configuration step and can most easily\r\nbe accomplished by using your browser to browse to the server.\r\n\r\nAvailable Class Variables\r\n-------------------------\r\n\r\nThe servers provided inherit from a log dispatch class that offers some class\r\nvariables to control how the server formats the log messages.  Those variables\r\nare:\r\n\r\n* prettyprint - Format the payload and responses so they are easier to read. The\r\n  default is False.\r\n* indent - When using prettyprint, how much indent should be used.  The default\r\n  is 4.\r\n* strip_imdata - When printing responses, do not print the whole response, only\r\n  print the contents of the im_data field.  The default is False.\r\n\r\nAll three of these variables are booleans and should be set to True or False.\r\n\r\nServer Test\r\n-----------\r\n\r\nBy convention the APIC does not use the GET method when communicating with the\r\nlogging server.  The APIC only uses POST to POST the log messages to the server.\r\nHowever, the servers provided by this module do offer a GET method to provide\r\na means of testing them.  If the server is working you will get the following\r\nresponse:  The server is working.\r\n\r\nAPIC Configuration\r\n------------------\r\n\r\nOnce the server is running, you can start remote logging from the APIC UI by\r\nselecting \"Start Remote Logging\" from the 'welcome, username' menu in the top\r\nright corner of the APIC UI.\r\n\r\n.. image:: https://raw.githubusercontent.com/datacenter/SimpleAciUiLogServer/master/start_remote_logging.png\r\n\r\nThen enter the URL the server is listening on:\r\n\r\n.. image:: https://raw.githubusercontent.com/datacenter/SimpleAciUiLogServer/master/enter_remote_logging_info.png\r\n\r\nIf you need to disable the remote logging from the APIC, you can do so from\r\nthe same menu and selecting 'Stop Remote Logging.'\r\n\r\n.. image:: https://raw.githubusercontent.com/datacenter/SimpleAciUiLogServer/master/stop_remote_logging.png\r\n\r\nNote:  If https is used to connect to the APIC, the server that is\r\ninstantiated will also need to be able to accept https connections.\r\n\r\nDebugging\r\n---------\r\n\r\nIf things do not seem to be working, the first step should be to open the\r\ndeveloper tools/javascript console for the browser and see if there are\r\nany errors being printed as you click on various items in the APIC GUI.\r\n\r\nAuthor and Acknowledgements\r\n---------------------------\r\n\r\nWritten by Mike Timm (mtimm@cisco.com)\r\nBased on code written by Fredrik Lundh & Brian Quinlan.\r\n \r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}